<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Sheets with Sign-In</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-xl mx-auto mt-20 text-center">
    <h1 class="text-3xl font-bold mb-4">Private Google Sheet Reader</h1>
    
    <div id="g_id_onload"
         data-client_id="897565146789-v31lkcru5irj0hap3hsb4qnjh3c5dtee.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="sign_in_with"
         data-size="large">
    </div>

    <div id="output" class="mt-10 p-4 bg-white shadow rounded text-left"></div>
  </div>

  <script>
    let accessToken = '';

    function handleCredentialResponse(response) {
      google.accounts.id.disableAutoSelect();

      // Load gapi to get the access token
      gapi.load('client', async () => {
        await gapi.client.init({
          clientId: '897565146789-v31lkcru5irj0hap3hsb4qnjh3c5dtee.apps.googleusercontent.com',
          scope: 'https://www.googleapis.com/auth/spreadsheets.readonly'
        });

        const tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: '897565146789-v31lkcru5irj0hap3hsb4qnjh3c5dtee.apps.googleusercontent.com',
          scope: 'https://www.googleapis.com/auth/spreadsheets.readonly',
          callback: (tokenResponse) => {
            accessToken = tokenResponse.access_token;
            fetchSheetData();
          },
        });

        tokenClient.requestAccessToken();
      });
    }

    async function fetchSheetData() {
      const SPREADSHEET_ID = '1j8hGtXsiWa3BDQIsKFqnBtCRc_dWN5gverMPNYw0lsU';
      const RANGE = 'Sheet1!A1:D10';

      const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}`, {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      });

      if (!response.ok) {
        document.getElementById('output').innerText = 'Failed to fetch sheet data.';
        return;
      }

      const data = await response.json();
      renderData(data.values);
    }

    function renderData(rows) {
      const output = document.getElementById('output');
      if (!rows || rows.length === 0) {
        output.innerText = 'No data found.';
        return;
      }

      let html = '<table class="w-full border-collapse border border-gray-300">';
      rows.forEach(row => {
        html += '<tr>';
        row.forEach(cell => {
          html += `<td class="border border-gray-300 px-3 py-2">${cell}</td>`;
        });
        html += '</tr>';
      });
      html += '</table>';
      output.innerHTML = html;
    }
  </script>

</body>
</html>
