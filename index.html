<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Sheets + PWA</title>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#4A90E2" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
</head>

<body class="bg-gray-100 text-gray-900 p-6">
  <h1 class="text-2xl font-bold mb-4">Google Sheet Data Viewer</h1>

  <div id="g_id_onload"
    data-client_id="897565146789-v31lkcru5irj0hap3hsb4qnjh3c5dtee.apps.googleusercontent.com"
    data-callback="handleCredentialResponse"
    data-auto_prompt="false">
  </div>

  <div class="g_id_signin"
    data-type="standard"
    data-size="large"
    data-theme="outline"
    data-text="sign_in_with"
    data-shape="rectangular"
    data-logo_alignment="left">
  </div>

  <div id="data-output" class="mt-8 p-4 bg-white rounded shadow"></div>

  <script>
    const SHEET_ID = '1j8hGtXsiWa3BDQIsKFqnBtCRc_dWN5gverMPNYw0lsU';
    const RANGE = 'Sheet1!A1:C10';

    function handleCredentialResponse(response) {
      const idToken = response.credential;
      google.accounts.id.disableAutoSelect();

      // Load Google API client
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: 'YOUR_API_KEY',
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
        }).then(() => {
          // Load token into client
          gapi.client.setToken({access_token: idToken});
          fetchSheetData();
        });
      });
    }

    function fetchSheetData() {
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SHEET_ID,
        range: RANGE,
      }).then(response => {
        const rows = response.result.values;
        let html = '<table class="table-auto w-full border"><thead><tr>';
        if (rows.length > 0) {
          rows[0].forEach(col => html += `<th class="border px-4 py-2">${col}</th>`);
          html += '</tr></thead><tbody>';
          for (let i = 1; i < rows.length; i++) {
            html += '<tr>';
            rows[i].forEach(cell => html += `<td class="border px-4 py-2">${cell}</td>`);
            html += '</tr>';
          }
          html += '</tbody></table>';
        } else {
          html = 'No data found.';
        }
        document.getElementById('data-output').innerHTML = html;
      }, error => {
        document.getElementById('data-output').textContent = 'Error loading data.';
        console.error(error);
      });
    }

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered', reg))
          .catch(err => console.error('Service Worker registration failed', err));
      });
    }
  </script>
</body>
</html>
